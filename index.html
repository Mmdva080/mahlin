<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    background: #0a0e17;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    touch-action: none;
    user-select: none;
    cursor: grab;
}

#login {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 90%;
    max-width: 350px;
    background: rgba(255,255,255,0.12);
    backdrop-filter: blur(20px);
    padding: 30px 35px;
    border-radius: 25px;
    border: 2px solid rgba(0,255,255,0.6);
    box-shadow: 0 0 40px rgba(0,255,255,0.8);
    text-align: center;
    color: white;
    font-family: Tahoma, sans-serif;
}

#login h1 {
    font-size: 30px;
    background: linear-gradient(90deg, #00ffff, #00b7eb);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 20px;
}

input, button {
    width: 100%;
    padding: 14px;
    margin: 12px 0;
    border: none;
    border-radius: 14px;
    font-size: 18px;
}

input {
    background: rgba(255,255,255,0.25);
    color: white;
    text-align: center;
}

button {
    background: linear-gradient(45deg, #00ffff, #0088ff);
    color: black;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
}

button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 25px cyan;
}
</style>

</head>
<body>

<div id="login">
    <h1>ورود</h1>
    <input type="text" id="user" placeholder="نام کاربری">
    <input type="password" id="pass" placeholder="رمز عبور">
    <button onclick="enter()">ورود</button>
</div>

<canvas id="worldCanvas"></canvas>

<audio id="meow" src="https://assets.mixkit.co/sfx/preview/mixkit-cat-meow-1456.mp3"></audio>
<audio id="purr" src="https://assets.mixkit.co/sfx/preview/mixkit-cat-purr-1457.mp3"></audio>

<script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
<script>
const MAX_CATS = 15;
let cats = [];

const canvas = document.getElementById('worldCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const login = document.getElementById('login');
const user = document.getElementById('user');
const pass = document.getElementById('pass');

let engine, world;

function enter() {
    if (user.value.trim() === 'ماهلین' && pass.value.trim() === 'ماهلین') {
        login.remove();
        initWorld();
        setInterval(addCat, 800);
    } else alert('هر دو را "ماهلین" بزن');
}

function initWorld() {
    engine = Matter.Engine.create();
    world = engine.world;
    world.gravity.y = 0.35;

    // دیوارهای نامرئی
    Matter.World.add(world, [
        Matter.Bodies.rectangle(innerWidth/2, -50, innerWidth+200, 100, { isStatic: true }),
        Matter.Bodies.rectangle(innerWidth/2, innerHeight+50, innerWidth+200, 100, { isStatic: true }),
        Matter.Bodies.rectangle(-50, innerHeight/2, 100, innerHeight+200, { isStatic: true }),
        Matter.Bodies.rectangle(innerWidth+50, innerHeight/2, 100, innerHeight+200, { isStatic: true })
    ]);

    Matter.Runner.run(Matter.Runner.create(), engine);
    requestAnimationFrame(draw);
}

function addCat() {
    if (cats.length >= MAX_CATS) {
        cats.shift();
    }

    const radius = 40;
    const body = Matter.Bodies.circle(innerWidth/2, innerHeight/2, radius, {
        restitution: 0.9,
        frictionAir: 0.01
    });
    Matter.World.add(world, body);

    cats.push({ body, radius, highlighted: false });
}

const catImage = new Image();
catImage.src = 'https://i.ibb.co/8bZkZy4/cat.png';

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    cats.forEach(cat => {
        ctx.save();
        ctx.translate(cat.body.position.x, cat.body.position.y);
        ctx.rotate(cat.body.angle);
        if(cat.highlighted){
            ctx.shadowColor = '#00ffff';
            ctx.shadowBlur = 20;
        } else {
            ctx.shadowBlur = 0;
        }
        ctx.drawImage(catImage, -cat.radius, -cat.radius, cat.radius*2, cat.radius*2);
        ctx.restore();
        cat.highlighted = false; // ریست highlight بعد هر frame
    });

    requestAnimationFrame(draw);
}

// بررسی لمس یا موس دقیق روی گربه‌ها
function handleInteraction(x, y) {
    cats.forEach(cat => {
        const dx = x - cat.body.position.x;
        const dy = y - cat.body.position.y;
        const distance = Math.sqrt(dx*dx + dy*dy);
        if(distance <= cat.radius){
            cat.highlighted = true;
            const s = Math.random() > 0.5 ? 'meow' : 'purr';
            document.getElementById(s).play();
        }
    });
}

// موس
canvas.addEventListener('mousemove', e => {
    if(e.buttons) handleInteraction(e.clientX, e.clientY);
});
canvas.addEventListener('mousedown', e => handleInteraction(e.clientX, e.clientY));

// لمس
canvas.addEventListener('touchstart', e => {
    e.preventDefault();
    for(const t of e.touches){
        handleInteraction(t.clientX, t.clientY);
    }
});
canvas.addEventListener('touchmove', e => {
    e.preventDefault();
    for(const t of e.touches){
        handleInteraction(t.clientX, t.clientY);
    }
});

window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>

</body>
</html>
